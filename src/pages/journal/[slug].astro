---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";

export const getStaticPaths: GetStaticPaths = async () => {
  const entries = await getCollection("journal", ({ data }) => !data.draft);
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
};

const { entry } = Astro.props;
const { Content } = await entry.render();

const pub = entry.data.pubDate?.toLocaleDateString("en-GB", {
  year: "numeric",
  month: "short",
  day: "2-digit",
});

const updated = entry.data.updatedDate
  ? entry.data.updatedDate.toLocaleDateString("en-GB", { year: "numeric", month: "short", day: "2-digit" })
  : null;

const tags = entry.data.tags || [];
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  canonicalPath={`/journal/${entry.slug}/`}
>
  <section class="card">
    <p style="margin:0 0 10px;">
      <a class="btn" href="/journal/">← Back to journal</a>
    </p>

    <h1 style="margin: 0 0 8px;">{entry.data.title}</h1>

    <div class="muted" style="font-size: 13px; margin-bottom: 10px;">
      {pub}
      {updated ? ` · Updated ${updated}` : ""}
    </div>

    {entry.data.description && (
      <p class="muted" style="margin:0 0 12px;">
        {entry.data.description}
      </p>
    )}

    {tags.length > 0 && (
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        {tags.map((t) => (
          <span class="pill">#{t}</span>
        ))}
      </div>
    )}
  </section>

  <section class="card" style="margin-top: 16px;">
    <Content />
  </section>

  <section style="margin-top: 16px;">
    <a class="btn" href="/journal/">← Back to journal</a>
  </section>
</BaseLayout>
