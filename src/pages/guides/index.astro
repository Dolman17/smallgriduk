---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const guidesAll = await getCollection("guides", ({ data }) => !data.draft);
const guides = guidesAll
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const allTags = Array.from(
  new Set(guides.flatMap((g) => g.data.tags || []))
).sort((a, b) => a.localeCompare(b));
---

<BaseLayout
  title="Guides"
  description="Low-power homelab and Jellyfin guides: mini PCs, networking, backups, and sane defaults."
  canonicalPath="/guides/"
>
  <section class="card">
    <h1 style="margin:0 0 8px;">Guides</h1>
    <p class="muted" style="margin:0;">
      Practical tutorials for quiet, low-power homelabs: Jellyfin, mini PC builds, simple networking, and backups.
    </p>

    {allTags.length > 0 && (
      <div style="margin-top: 12px;">
        <div class="muted" style="font-size: 13px;">Popular tags</div>
        <div>
          {allTags.map((t) => <span class="pill">#{t}</span>)}
        </div>
      </div>
    )}
  </section>

  <section style="margin-top: 16px;">
    <div class="grid">
      {guides.map((post) => (
        <article class="card">
          <h2 style="margin: 0 0 8px; font-size: 18px;">
            <a href={`/guides/${post.slug}/`}>{post.data.title}</a>
          </h2>
          <div class="muted" style="font-size: 13px; margin-bottom: 8px;">
            {post.data.pubDate.toLocaleDateString("en-GB", { year: "numeric", month: "short", day: "2-digit" })}
            {post.data.updatedDate ? ` Â· Updated ${post.data.updatedDate.toLocaleDateString("en-GB", { year: "numeric", month: "short", day: "2-digit" })}` : ""}
          </div>
          <p class="muted" style="margin:0 0 10px;">{post.data.description}</p>
          <div>
            {(post.data.tags || []).slice(0, 6).map((t) => (
              <span class="pill">#{t}</span>
            ))}
          </div>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
