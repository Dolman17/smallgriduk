---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const guides = await getCollection("guides", ({ data }) => !data.draft);
  return guides.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const published = entry.data.pubDate.toLocaleDateString("en-GB", {
  year: "numeric",
  month: "short",
  day: "2-digit",
});

const updated = entry.data.updatedDate
  ? entry.data.updatedDate.toLocaleDateString("en-GB", {
      year: "numeric",
      month: "short",
      day: "2-digit",
    })
  : null;
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  canonicalPath={`/guides/${entry.slug}/`}
>
  <article class="card" style="padding: 20px;">
    <div class="kicker">
      ğŸ“˜ SmallGrid guide
      <span style="opacity:.7;">
        Â· Published {published}
        {updated ? ` Â· Updated ${updated}` : ""}
      </span>
    </div>

    <h1 style="margin: 6px 0 10px;">{entry.data.title}</h1>
    <p style="margin:0 0 12px; color: var(--muted);">
      {entry.data.description}
    </p>

    {(entry.data.tags && entry.data.tags.length > 0) && (
      <div style="margin-bottom: 12px;">
        {entry.data.tags.map((tag: string) => (
          <span class="pill">#{tag}</span>
        ))}
      </div>
    )}

    <div class="hr"></div>

    <div class="prose">
      <Content />
    </div>

    <div class="hr"></div>

    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a class="btn" href="/guides/">â† Back to all guides</a>
      <a class="btn primary" href="/contact/">Ask a question</a>
    </div>
  </article>
</BaseLayout>
