---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const guides = await getCollection("guides");

  return guides.map((guide) => ({
    // Astro expects a string/number/undefined for route params.
    params: { slug: guide.slug },
    props: { guide },
  }));
}

interface Props {
  guide: any;
}

const { guide } = Astro.props as Props;

// Frontmatter lives on guide.data (NOT on the render() return)
const data = guide.data;

// Render gives you the compiled Markdown component
const { Content } = await guide.render();

// Derive a readable date string (fallback to "now" to avoid build failures)
const pubDate =
  data?.pubDate instanceof Date
    ? data.pubDate
    : new Date(data?.pubDate ?? Date.now());
---

<BaseLayout title={data.title} description={data.description}>
  <header class="article-header">
    <p class="article-kicker">Guide Â· SmallGrid</p>

    <h1 class="article-title">
      {data.title}
    </h1>

    <div class="article-meta">
      <span class="article-meta-item">
        <span>Updated</span>
        <time datetime={pubDate.toISOString()}>
          {pubDate.toLocaleDateString("en-GB", {
            year: "numeric",
            month: "short",
            day: "2-digit",
          })}
        </time>
      </span>

      {data.tags && Array.isArray(data.tags) && data.tags.length > 0 && (
        <ul class="article-tags">
          {data.tags.map((tag: string) => (
            <li class="tag-pill">{tag}</li>
          ))}
        </ul>
      )}
    </div>
  </header>

  <hr class="article-divider" />

  <Content />
</BaseLayout>
