---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const guides = await getCollection("guides", ({ data }) => !data.draft);
  return guides.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const published = entry.data.pubDate.toLocaleDateString("en-GB", {
  year: "numeric",
  month: "short",
  day: "2-digit",
});
const updated = entry.data.updatedDate
  ? entry.data.updatedDate.toLocaleDateString("en-GB", { year: "numeric", month: "short", day: "2-digit" })
  : null;
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  canonicalPath={`/guides/${entry.slug}/`}
>
  <article class="card" style="padding: 18px;">
    <div class="muted" style="font-size: 13px;">
      Published {published}{updated ? ` · Updated ${updated}` : ""}
    </div>
    <h1 style="margin: 6px 0 10px;">{entry.data.title}</h1>
    <p class="muted" style="margin:0 0 14px;">{entry.data.description}</p>

    <div style="margin-bottom: 14px;">
      {(entry.data.tags || []).map((t) => <span class="pill">#{t}</span>)}
    </div>

    <div class="hr"></div>

    <div class="content">
      <Content />
    </div>

    <div class="hr"></div>

    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a class="chip" href="/guides/">← Back to Guides</a>
      <a class="chip" href="/contact/">Ask a question</a>
    </div>
  </article>
</BaseLayout>
